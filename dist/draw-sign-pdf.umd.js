(function(P,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("pdfjs-dist"),require("downloadjs"),require("pdf-lib")):typeof define=="function"&&define.amd?define(["exports","vue","pdfjs-dist","downloadjs","pdf-lib"],e):(P=typeof globalThis<"u"?globalThis:P||self,e(P.DrawSignPdf={},P.Vue,P.pdfjsLib,P.download,P.PDFLib))})(this,function(P,e,Z,ee,U){"use strict";function te(t){const o=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const s in t)if(s!=="default"){const a=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(o,s,a.get?a:{enumerable:!0,get:()=>t[s]})}}return o.default=t,Object.freeze(o)}const G=te(Z),ne={props:{page:Object,zoomScale:Number,finishedRendering:Function},setup(t,{emit:o}){const s=e.ref(null),a=e.ref(0),i=e.ref(0),d=()=>{s.value&&s.value.clientWidth&&a.value&&o("measure",{scale:s.value.clientWidth/a.value})};return e.onMounted(async()=>{const l=await t.page,n=s.value.getContext("2d"),w=l.getViewport({scale:t.zoomScale||1,rotation:0});a.value=w.width,i.value=w.height,await l.render({canvasContext:n,viewport:w}).promise.then(function(){o("finishedRendering"),d()}),window.addEventListener("resize",d)}),e.onBeforeUnmount(()=>{window.removeEventListener("resize",d)}),{canvas:s,width:a,height:i}}},A=(t,o)=>{const s=t.__vccOpts||t;for(const[a,i]of o)s[a]=i;return s},oe=["width","height"];function ae(t,o,s,a,i,d){return e.openBlock(),e.createElementBlock("div",null,[e.createElementVNode("canvas",{ref:"canvas",id:"canvas",class:"max-w-full",style:e.normalizeStyle({width:`${a.width}px`}),width:a.width,height:a.height},null,12,oe)])}const le=A(ne,[["render",ae],["__scopeId","data-v-fc4cca72"]]),re=e.defineComponent({props:{originWidth:{type:Number,required:!0},originHeight:{type:Number,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},x:{type:Number,required:!0},y:{type:Number,required:!0},pageScale:{type:Number,default:1},path:{type:String,required:!0},zoomScale:{type:Number,required:!0}},emits:["delete","update"],setup(t,{emit:o}){const s=e.ref(0),a=e.ref(0),i=e.ref(0),d=e.ref(""),l=e.ref(""),n=e.ref(0),w=e.ref(0),b=e.ref(null),u=t.originWidth/t.originHeight;return e.onMounted(async()=>{await e.nextTick(),b.value&&b.value.setAttribute("viewBox",`0 0 ${t.originWidth} ${t.originHeight}`)}),{dx:s,dy:a,dw:i,direction:d,operation:l,startX:n,startY:w,svg:b,ratio:u,handlePanStart:m=>{if(n.value=m instanceof MouseEvent?m.clientX:m.touches[0].clientX,w.value=m instanceof MouseEvent?m.clientY:m.touches[0].clientY,m.target===m.currentTarget)l.value="move";else{const v=m.target;l.value="scale",d.value=v.dataset.direction||""}},handlePanMove:m=>{const v=m instanceof MouseEvent?m.clientX:m.touches[0].clientX,S=m instanceof MouseEvent?m.clientY:m.touches[0].clientY,B=v-n.value,r=S-w.value;if(l.value==="move")s.value=B/t.pageScale,a.value=r/t.pageScale;else if(l.value==="scale"){if(d.value==="left-top"){const g=Math.min(B,r*u);s.value=g,i.value=-g,a.value=g/u}if(d.value==="right-bottom"){const g=Math.max(B,r*u);i.value=g}}},handlePanEnd:()=>{l.value==="move"?(o("update",{x:t.x+s.value,y:t.y+a.value}),s.value=0,a.value=0):l.value==="scale"&&(o("update",{x:t.x+s.value,y:t.y+a.value,width:t.width+i.value,scale:(t.width+i.value)/t.originWidth}),s.value=0,a.value=0,i.value=0,d.value=""),l.value=""},onDelete:()=>{o("delete")}}}}),se="data:image/svg+xml,%3csvg%20height='512pt'%20viewBox='0%200%20512%20512'%20width='512pt'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill='%23f56565'%20d='m437.019531%2074.980469c-48.351562-48.351563-112.640625-74.980469-181.019531-74.980469s-132.667969%2026.628906-181.019531%2074.980469c-48.351563%2048.351562-74.980469%20112.640625-74.980469%20181.019531%200%2068.382812%2026.628906%20132.667969%2074.980469%20181.019531%2048.351562%2048.351563%20112.640625%2074.980469%20181.019531%2074.980469s132.667969-26.628906%20181.019531-74.980469c48.351563-48.351562%2074.980469-112.636719%2074.980469-181.019531%200-68.378906-26.628906-132.667969-74.980469-181.019531zm-70.292969%20256.386719c9.761719%209.765624%209.761719%2025.59375%200%2035.355468-4.882812%204.882813-11.28125%207.324219-17.679687%207.324219s-12.796875-2.441406-17.679687-7.324219l-75.367188-75.367187-75.367188%2075.371093c-4.882812%204.878907-11.28125%207.320313-17.679687%207.320313s-12.796875-2.441406-17.679687-7.320313c-9.761719-9.765624-9.761719-25.59375%200-35.355468l75.371093-75.371094-75.371093-75.367188c-9.761719-9.765624-9.761719-25.59375%200-35.355468%209.765624-9.765625%2025.59375-9.765625%2035.355468%200l75.371094%2075.367187%2075.367188-75.367187c9.765624-9.761719%2025.59375-9.765625%2035.355468%200%209.765625%209.761718%209.765625%2025.589844%200%2035.355468l-75.367187%2075.367188zm0%200'/%3e%3c/svg%3e",ie={ref:"svg",width:"100%",height:"100%"},de=["d"];function ce(t,o,s,a,i,d){return e.openBlock(),e.createElementBlock("div",{style:e.normalizeStyle({width:`${(t.width+t.dw)*t.zoomScale}px`,height:`${(t.height+t.dw)*t.zoomScale}px`,transform:`translate(${(t.x+t.dx)*t.zoomScale}px, ${(t.y+t.dy)*t.zoomScale}px)`}),class:"absolute left-0 top-0 select-none"},[e.createElementVNode("div",{class:e.normalizeClass(["absolute h-full w-full cursor-grab border border-dashed border-gray-400",{"cursor-grabbing":t.operation==="move",operation:t.operation}]),onMousedown:o[0]||(o[0]=(...l)=>t.handlePanStart&&t.handlePanStart(...l)),onMousemove:o[1]||(o[1]=(...l)=>t.handlePanMove&&t.handlePanMove(...l)),onMouseup:o[2]||(o[2]=(...l)=>t.handlePanEnd&&t.handlePanEnd(...l)),onTouchstart:o[3]||(o[3]=(...l)=>t.handlePanStart&&t.handlePanStart(...l)),onTouchmove:o[4]||(o[4]=(...l)=>t.handlePanMove&&t.handlePanMove(...l)),onTouchend:o[5]||(o[5]=(...l)=>t.handlePanEnd&&t.handlePanEnd(...l))},o[7]||(o[7]=[e.createElementVNode("div",{"data-direction":"left-top",class:"absolute left-0 top-0 h-4 w-4 -translate-x-1/2 -translate-y-1/2 transform cursor-nwse-resize rounded-full bg-green-400 md:scale-25"},null,-1),e.createElementVNode("div",{"data-direction":"right-bottom",class:"absolute bottom-0 right-0 h-4 w-4 translate-x-1/2 translate-y-1/2 transform cursor-nwse-resize rounded-full bg-green-400 md:scale-25"},null,-1)]),34),e.createElementVNode("div",{onClick:o[6]||(o[6]=(...l)=>t.onDelete&&t.onDelete(...l)),class:"absolute left-0 right-0 top-0 m-auto h-4 w-4 -translate-y-1/2 transform cursor-pointer rounded-full bg-white md:scale-25"},o[8]||(o[8]=[e.createElementVNode("img",{class:"h-full w-full",src:se,alt:"delete","data-cy":"delete-sign"},null,-1)])),(e.openBlock(),e.createElementBlock("svg",ie,[e.createElementVNode("path",{"stroke-width":"5","stroke-linejoin":"round","stroke-linecap":"round",stroke:"black",fill:"none",d:t.path},null,8,de)],512))],4)}const ge=A(re,[["render",ce],["__scopeId","data-v-9fe1a5ff"]]),me=e.defineComponent({name:"DialogBox",props:{translations:{type:Object,default:()=>({})},type:{type:String,default:"warning"}},emits:["finish","cancel"],setup(t,{emit:o}){return{getTranslation:e.computed(()=>{const d=t.translations;return t.type==="warning"?{title:d.warningTitle,desc:d.warningDesc,close:d.warningClose}:{title:d.confirmBoxTitle,desc:d.confirmBoxDesc,close:d.confirmBoxClose,saveChanges:d.confirmBoxSaveChanges}}),closeModal:()=>o("cancel"),finish:()=>o("finish")}}}),fe={class:"confirm-modal relative top-40 mx-auto shadow-xl rounded-md bg-white max-w-md mt-40"},he={class:"flex flex-col bg-white border shadow-sm rounded-xl pointer-events-auto"},ue={class:"flex justify-between items-center py-3 px-4 border-b"},pe={class:"font-bold text-gray-800"},ye={class:"sr-only"},we={class:"p-4 overflow-y-auto"},be={class:"mt-1 text-gray-800"},ve={class:"flex justify-end items-center gap-x-2 py-3 px-4 border-t"};function xe(t,o,s,a,i,d){return e.openBlock(),e.createElementBlock(e.Fragment,null,[o[4]||(o[4]=e.createElementVNode("div",{id:"headlessui-dialog-overlay-16","aria-hidden":"true","data-headlessui-state":"open",class:"fixed inset-0 bg-gray-500 opacity-30"},null,-1)),e.createElementVNode("div",fe,[e.createElementVNode("div",he,[e.createElementVNode("div",ue,[e.createElementVNode("h3",pe,e.toDisplayString(t.getTranslation.title),1),e.createElementVNode("button",{onClick:o[0]||(o[0]=(...l)=>t.closeModal&&t.closeModal(...l)),type:"button",class:"flex justify-center items-center size-7 text-sm font-semibold rounded-full border border-transparent text-gray-800 hover:bg-gray-100 disabled:opacity-50 disabled:pointer-events-none"},[e.createElementVNode("span",ye,e.toDisplayString(t.getTranslation.close),1),o[3]||(o[3]=e.createElementVNode("svg",{class:"flex-shrink-0 size-4",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e.createElementVNode("path",{d:"M18 6 6 18"}),e.createElementVNode("path",{d:"m6 6 12 12"})],-1))])]),e.createElementVNode("div",we,[e.createElementVNode("p",be,e.toDisplayString(t.getTranslation.desc),1)]),e.createElementVNode("div",ve,[e.createElementVNode("button",{onClick:o[1]||(o[1]=(...l)=>t.closeModal&&t.closeModal(...l)),type:"button","data-cy":"close-confirm",class:"py-2 px-3 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none btn-negative"},e.toDisplayString(t.getTranslation.close),1),t.type==="confirm"?(e.openBlock(),e.createElementBlock("button",{key:0,onClick:o[2]||(o[2]=(...l)=>t.finish&&t.finish(...l)),type:"button","data-cy":"confirm-save",class:"py-2 px-3 inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none ml-2 btn-positive"},e.toDisplayString(t.getTranslation.saveChanges),1)):e.createCommentVNode("",!0)])])])],64)}const Ee=A(me,[["render",xe],["__scopeId","data-v-a1ca1473"]]),De=e.defineComponent({name:"DrawingCanvas",props:{translations:{type:Object,default:()=>({})}},emits:["finish","cancel"],setup(t,{emit:o}){const s={drawLabel:"Draw the signature here",drawDone:"Done",drawCancel:"Cancel",additionalTextField:""},a=e.computed(()=>({...s,...t.translations})),i=e.ref(null),d=e.ref([]),l=e.ref(""),n=e.reactive({drawing:!1,x:0,y:0,minX:1/0,minY:1/0,maxX:0,maxY:0}),w=r=>{if(r.target!==r.currentTarget){n.drawing=!1;return}n.drawing=!0,n.x=r.x,n.y=r.y,n.minX=Math.min(n.minX,n.x),n.maxX=Math.max(n.maxX,n.x),n.minY=Math.min(n.minY,n.y),n.maxY=Math.max(n.maxY,n.y),d.value.push(["M",n.x,n.y]),l.value+=`M${n.x},${n.y}`},b=r=>{n.drawing&&(n.x=r.x,n.y=r.y,n.minX=Math.min(n.minX,n.x),n.maxX=Math.max(n.maxX,n.x),n.minY=Math.min(n.minY,n.y),n.maxY=Math.max(n.maxY,n.y),l.value+=`L${n.x},${n.y}`,d.value.push(["L",n.x,n.y]))},u=()=>{n.drawing=!1},M=()=>{var X;if(!d.value.length)return;const r=-(n.minX-10),g=-(n.minY-10),p=n.maxX-n.minX+20,N=n.maxY-n.minY+20,L=d.value.reduce((_,T)=>_+T[0]+(T[1]+r)+","+(T[2]+g),""),C=document.getElementById("signature-path-data");if(C){C.style.display="none",C.removeAttribute("viewBox"),(X=C.querySelector("path"))==null||X.setAttribute("d",L);const _=new XMLSerializer().serializeToString(C),T=btoa(_),O=new Image;O.src="data:image/svg+xml;base64,"+T,O.onload=()=>{const F=document.createElement("canvas");F.style.display="none",F.width=p,F.height=N;const $=F.getContext("2d");$==null||$.drawImage(O,0,0);let q=F.toDataURL("image/png").replace("data:image/png;base64,","");F.remove(),C.innerHTML="",d.value=[],o("finish",{originWidth:p,originHeight:N,path:L,signatureImageData:{data:q,type:"image/png"}})}}},h=()=>{d.value=[],o("cancel")},y=r=>{var g,p;n.x=r.clientX,n.y=r.clientY,w({x:n.x,y:n.y,target:r.target,currentTarget:i.value}),(g=i.value)==null||g.addEventListener("mousemove",f),(p=i.value)==null||p.addEventListener("mouseup",m)},f=r=>{r.clientX-n.x,r.clientY-n.y,n.x=r.clientX,n.y=r.clientY,b({x:n.x,y:n.y})},m=r=>{var g,p;n.x=r.clientX,n.y=r.clientY,u(),(g=i.value)==null||g.removeEventListener("mousemove",f),(p=i.value)==null||p.removeEventListener("mouseup",m)},v=r=>{var p,N;if(r.touches.length>1)return;const g=r.touches[0];n.x=g.clientX,n.y=g.clientY,w({x:n.x,y:n.y,target:g.target,currentTarget:i.value}),(p=i.value)==null||p.addEventListener("touchmove",S),(N=i.value)==null||N.addEventListener("touchend",B)},S=r=>{if(r.preventDefault(),r.touches.length>1)return;const g=r.touches[0];g.clientX-n.x,g.clientY-n.y,n.x=g.clientX,n.y=g.clientY,b({x:n.x,y:n.y})},B=r=>{var g,p;n.x=r.changedTouches[0].clientX,n.y=r.changedTouches[0].clientY,u(),(g=i.value)==null||g.removeEventListener("touchmove",S),(p=i.value)==null||p.removeEventListener("touchend",B)};return e.onMounted(()=>{var r,g;(r=i.value)==null||r.addEventListener("mousedown",y),(g=i.value)==null||g.addEventListener("touchstart",v)}),e.onBeforeUnmount(()=>{var r,g;(r=i.value)==null||r.removeEventListener("mousedown",y),(g=i.value)==null||g.removeEventListener("touchstart",v)}),{getTranslation:a,signatureCanvas:i,path:l,finish:M,cancel:h,handlePanStart:w,handlePanMove:b,handlePanEnd:u}}}),ke={style:{height:"210px"},class:"left-0 right-0 top-0 z-0 border-b border-gray-300 bg-white shadow-lg","data-cy":"sign-area"},Pe={class:"absolute flex w-full flex-grow items-center justify-center"},Se={class:"text-black-600"},Be={class:"absolute bottom-0 right-0 mb-4 mx-4 flex"},Me={class:"flex w-full flex-grow items-center justify-center"},Ce={class:"text-black-600"},Ne={class:"pointer-events-none h-full w-full",id:"signature-path-data"},Ve=["d"];function Te(t,o,s,a,i,d){return e.openBlock(),e.createElementBlock("div",ke,[e.createElementVNode("div",{ref:"signatureCanvas",onPanstart:o[2]||(o[2]=(...l)=>t.handlePanStart&&t.handlePanStart(...l)),onPanmove:o[3]||(o[3]=(...l)=>t.handlePanMove&&t.handlePanMove(...l)),onPanend:o[4]||(o[4]=(...l)=>t.handlePanEnd&&t.handlePanEnd(...l)),class:"relative h-full w-full select-none"},[e.createElementVNode("div",Pe,[e.createElementVNode("p",Se,e.toDisplayString(t.getTranslation.drawLabel),1)]),e.createElementVNode("div",Be,[e.createElementVNode("div",Me,[e.createElementVNode("p",Ce,e.toDisplayString(t.getTranslation.additionalTextField),1)]),e.createElementVNode("button",{onClick:o[0]||(o[0]=(...l)=>t.finish&&t.finish(...l)),class:"mx-4 w-24 rounded bg-blue-600 px-4 py-1 font-bold text-white hover:bg-blue-700 btn-positive","data-cy":"sign-done"},e.toDisplayString(t.getTranslation.drawDone),1),e.createElementVNode("button",{onClick:o[1]||(o[1]=(...l)=>t.cancel&&t.cancel(...l)),class:"w-24 rounded bg-red-500 px-4 py-1 font-bold text-white hover:bg-red-700 btn-negative","data-cy":"sign-cancel"},e.toDisplayString(t.getTranslation.drawCancel),1)]),(e.openBlock(),e.createElementBlock("svg",Ne,[e.createElementVNode("path",{"stroke-width":"5","stroke-linejoin":"round","stroke-linecap":"round",d:t.path,stroke:"black",fill:"none"},null,8,Ve)]))],544)])}const Fe=A(De,[["render",Te]]);function ze(t,o){return e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e.createElementVNode("path",{d:"M8.75 6.25h-3.5a.75.75 0 0 0 0 1.5h3.5a.75.75 0 0 0 0-1.5Z"}),e.createElementVNode("path",{"fill-rule":"evenodd",d:"M7 12c1.11 0 2.136-.362 2.965-.974l2.755 2.754a.75.75 0 1 0 1.06-1.06l-2.754-2.755A5 5 0 1 0 7 12Zm0-1.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z","clip-rule":"evenodd"})])}function Le(t,o){return e.openBlock(),e.createElementBlock("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e.createElementVNode("path",{d:"M6.25 8.75v-1h-1a.75.75 0 0 1 0-1.5h1v-1a.75.75 0 0 1 1.5 0v1h1a.75.75 0 0 1 0 1.5h-1v1a.75.75 0 0 1-1.5 0Z"}),e.createElementVNode("path",{"fill-rule":"evenodd",d:"M7 12c1.11 0 2.136-.362 2.965-.974l2.755 2.754a.75.75 0 1 0 1.06-1.06l-2.754-2.755A5 5 0 1 0 7 12Zm0-1.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z","clip-rule":"evenodd"})])}const J=()=>{const t=G.version||"4.8.69";G.GlobalWorkerOptions.workerSrc=`https://unpkg.com/pdfjs-dist@${t}/build/pdf.worker.min.js`},Xe=async(t,o="string")=>{let s;if(o==="string"&&typeof t=="string"){console.log("Processing string input, length:",t.length);const d=atob(t);console.log("Binary string length:",d.length);const l=new Uint8Array(d.length);for(let n=0;n<d.length;n++)l[n]=d.charCodeAt(n);s=l.buffer,console.log("ArrayBuffer size:",s.byteLength)}else if(t instanceof File)console.log("Processing File input, size:",t.size),s=await t.arrayBuffer(),console.log("File ArrayBuffer size:",s.byteLength);else throw new Error("Invalid input type for readAsPDF");const{PDFDocument:a}=await import("pdf-lib"),i=await a.load(s);return console.log("PDF document loaded successfully"),i},Oe=(t,o)=>{ee(t,o,"application/pdf")},Ye=async t=>{console.log("Getting PDF document from pdf-lib document");const o=await t.save();console.log("PDF bytes length:",o.length);const s=Z.getDocument({data:o});return console.log("PDF.js loading task created"),s.promise};function Ae(){let t=0;return function(){return t++}}async function je(t,o,s,a=!1){let i;try{const l=await t.arrayBuffer();i=await U.PDFDocument.load(l)}catch(l){throw console.error("Error loading PDF:",l),l}const d=i.getPages().map(async(l,n)=>{const w=o[n]||[],b=l.getHeight(),u=w.map(async h=>{if(h.type==="drawing"){const{x:y,y:f,path:m,originWidth:v,originHeight:S,width:B,height:r,scale:g}=h,p=v*g,N=S*g,L=y+(B-p)/2,C=f+(r-N)/2;l.drawSvgPath(m,{x:L,y:b-C,scale:g,borderWidth:5,borderColor:U.rgb(0,0,0),borderLineCap:"Round",borderLineJoin:"Round"})}});(await Promise.all(u)).forEach(h=>h&&h())});await Promise.all(d);try{const l=await i.save();return a&&Oe(l,s),await i.saveAsBase64()}catch(l){throw console.error("Error saving PDF:",l),l}}const _e={name:"DrawSignPdf",components:{PDFPage:le,DrawingCanvas:Fe,DrawingSignature:ge,DialogBox:Ee,MagnifyingGlassMinusIcon:ze,MagnifyingGlassPlusIcon:Le},props:{pdfData:String,signatureData:Array,isDownload:{type:Boolean,default:!1},finish:Function,translations:{type:Object,default:()=>({})},enableZoom:{type:Boolean,default:!1}},emits:["finish","onPDFRendered"],setup(t,{emit:o}){const s=Ae(),a=e.ref(null),i=e.ref(""),d=e.ref([]),l=e.ref([]),n=e.ref([]),w=e.ref("Times-Roman"),b=e.ref(null),u=e.ref(-1),M=e.ref(!1),h=e.ref(!1),y=e.ref(""),f=e.ref({data:"",type:"application/pdf"}),m=e.ref(!1),v=e.ref("warning"),S=e.ref(1),B=.25,r=.5,g=3,p=e.ref([]),N=e.computed(()=>({...{updateSign:"Update Signature",save:"Save",saving:"Saving",drawLabel:"Draw the signature here",drawDone:"Done",drawCancel:"Cancel",confirmBoxTitle:"Confirm Saving",confirmBoxDesc:"Are you sure you want to save the signed document?",confirmBoxClose:"Close",confirmBoxSaveChanges:"Save Changes",warningTitle:"Missing Signature",warningDesc:"The required signature is missing. Please sign to continue",warningClose:"Close",pdfLoading:"PDF will load here",additionalTextField:""},...t.translations})),L=async()=>{try{if(J(),!t.pdfData)return;u.value=0,await X(t.pdfData,"string"),T(),document.addEventListener("keydown",Q)}catch(c){console.error("onMounted error:",c)}},C=async c=>{const E=(c.target.files||c.dataTransfer&&c.dataTransfer.files)[0];if(!(!E||E.type!=="application/pdf")){u.value=-1;try{await X(E,"arrayBuffer"),u.value=0}catch{}}},X=async(c,x)=>{const E=await Xe(c,x),D=await Ye(E),k=[];for(let V=1;V<=D.numPages;V++){const z=await D.getPage(V);k.push(e.markRaw(z))}if(d.value=k,n.value=Array(D.numPages).fill([]),l.value=Array(D.numPages).fill({scale:1}),p.value=Array(D.numPages).fill(!1),x==="string"){const V=atob(c),z=new Uint8Array(V.length);for(let Y=0;Y<V.length;Y++)z[Y]=V.charCodeAt(Y);const W=new Blob([z],{type:"application/pdf"});a.value=new File([W],"document.pdf",{type:"application/pdf"}),i.value="document.pdf"}},_=async c=>{y.value=c.signatureImageData,await O(c.originWidth,c.originHeight,c.path),h.value=!1},T=()=>{u.value>=0&&(h.value=!0)},O=(c,x,E)=>{var D;n.value=Array(n.value.length).fill([]),(D=t.signatureData)==null||D.forEach(k=>{const V=s(),z=I(k.width),W=I(k.height),Y=z/c,lt=W/x,rt=Math.min(Y,lt),st={id:V,path:E,type:"drawing",x:I(k.left),y:I(k.top),originWidth:c,originHeight:x,width:z,height:W,scale:rt},R=k.page-1;n.value[R]&&(n.value[R]=[...n.value[R],st])})},F=c=>{u.value=c},$=(c,x)=>{n.value=n.value.map((E,D)=>D==u.value?E.map(k=>k.id===c?{...k,...x}:k):E)},q=c=>{n.value=n.value.map((x,E)=>E==u.value?x.filter(D=>D.id!==c):x)},et=(c,x)=>{l.value[x]=c},I=c=>c*72/2.54,K=async()=>{if(!(!a.value||M.value||!d.value.length)){M.value=!0;try{const c=await je(a.value,n.value,i.value,t.isDownload);f.value={type:"application/pdf",data:c},o("finish",{signedDocument:f.value,signatureImage:y.value})}catch(c){console.error("Error saving PDF:",c)}finally{M.value=!1}}},tt=()=>{v.value=y.value!==""?"confirm":"warning",m.value=!0,document.body.classList.add("overflow-y-hidden")},H=()=>{m.value=!1,document.body.classList.remove("overflow-y-hidden")},nt=()=>{K(),H()},Q=c=>{(c.key==="Escape"||c.key==="Esc")&&H()},ot=c=>{S.value=c==="in"?Math.min(S.value+B,g):Math.max(S.value-B,r)},at=c=>{p.value[c]=!0,p.value.every(Boolean)&&o("onPDFRendered")};return e.onMounted(L),e.onBeforeUnmount(()=>{document.removeEventListener("keydown",Q)}),{getTranslation:N,genID:s,pdfFile:a,pdfName:i,pages:d,pagesScale:l,allObjects:n,currentFont:w,focusId:b,selectedPageIndex:u,saving:M,addingDrawing:h,isOpenConfirm:m,onUploadPDF:C,addPDF:X,onAddDrawing:T,addDrawing:O,selectPage:F,updateObject:$,deleteObject:q,onMeasure:et,savePDF:K,onFinishDrawing:_,openModal:tt,closeModal:H,confirmSave:nt,isConfirmOrWarning:v,zoomScale:S,zoomPDF:ot,pageRenderStatus:p,renderFinished:at}}},$e={key:0,id:"modelConfirm",class:"fixed inset-0 z-50 h-full w-full overflow-y-auto bg-gray-900 bg-opacity-60 px-4"},Ie={class:"flex min-h-screen flex-col items-center bg-gray-100 py-5"},We={key:0,class:"left-0 right-0 top-0 z-10 flex items-center justify-center flex-col gap-2 py-2 bg-gray-100 sticky w-full"},qe={key:1,class:"mt-2 flex gap-2"},He={key:2,class:"sign-drawing-canvas fixed left-0 right-0 top-0 z-10 items-center justify-center border-b border-gray-300 bg-white shadow-lg",style:{height:"200px","z-index":"60",width:"100%"},"data-cy":"sign-drawing-canvas"},Re={key:0,class:"bg-gray-100 border-b border-gray-300 shadow-lg p-2 flex justify-center gap-2"},Ze={key:3,class:"w-full"},Ue=["onMousedown","onTouchstart","data-cy"],Ge={key:4,class:"flex w-full flex-grow items-center justify-center"},Je={class:"text-3xl font-bold text-gray-500"};function Ke(t,o,s,a,i,d){const l=e.resolveComponent("DialogBox"),n=e.resolveComponent("MagnifyingGlassMinusIcon"),w=e.resolveComponent("MagnifyingGlassPlusIcon"),b=e.resolveComponent("DrawingCanvas"),u=e.resolveComponent("PDFPage"),M=e.resolveComponent("DrawingSignature");return e.openBlock(),e.createElementBlock(e.Fragment,null,[a.isOpenConfirm?(e.openBlock(),e.createElementBlock("div",$e,[e.createVNode(l,{translations:a.getTranslation,type:a.isConfirmOrWarning,onCancel:a.closeModal,onFinish:a.confirmSave},null,8,["translations","type","onCancel","onFinish"])])):e.createCommentVNode("",!0),e.createElementVNode("div",null,[e.createElementVNode("main",Ie,[a.addingDrawing?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",We,[e.createElementVNode("button",{onClick:o[0]||(o[0]=(...h)=>a.onAddDrawing&&a.onAddDrawing(...h)),class:"btn-positive ml-3 mr-3 rounded bg-blue-500 px-3 py-1 font-bold text-white hover:bg-blue-700 md:mr-4 md:px-4","data-cy":"update-sign"},e.toDisplayString(a.getTranslation.updateSign),1),e.createElementVNode("button",{onClick:o[1]||(o[1]=(...h)=>a.openModal&&a.openModal(...h)),class:e.normalizeClass(["btn-positive mr-3 rounded bg-blue-500 px-3 py-1 font-bold text-white hover:bg-blue-700 md:mr-4 md:px-4",{"cursor-not-allowed":a.pages.length===0||a.saving,"bg-blue-700":a.pages.length===0||a.saving}]),"data-cy":"save-sign"},e.toDisplayString(a.saving?a.getTranslation.saving:a.getTranslation.save),3)])),s.enableZoom?(e.openBlock(),e.createElementBlock("div",qe,[e.createElementVNode("button",{onClick:o[2]||(o[2]=h=>a.zoomPDF("out")),class:"w-6","data-cy":"pdf-zoom-out"},[e.createVNode(n)]),e.createElementVNode("button",{onClick:o[3]||(o[3]=h=>a.zoomPDF("in")),class:"w-6","data-cy":"pdf-zoom-in"},[e.createVNode(w)])])):e.createCommentVNode("",!0),a.addingDrawing?(e.openBlock(),e.createElementBlock("div",He,[e.createVNode(b,{onFinish:a.onFinishDrawing,onCancel:o[4]||(o[4]=h=>a.addingDrawing=!1),translations:a.getTranslation},null,8,["onFinish","translations"]),s.enableZoom?(e.openBlock(),e.createElementBlock("div",Re,[e.createElementVNode("button",{onClick:o[5]||(o[5]=h=>a.zoomPDF("out")),class:"w-6","data-cy":"pdf-zoom-out-toolbar"},[e.createVNode(n)]),e.createElementVNode("button",{onClick:o[6]||(o[6]=h=>a.zoomPDF("in")),class:"w-6","data-cy":"pdf-zoom-in-toolbar"},[e.createVNode(w)])])):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0),a.pages.length?(e.openBlock(),e.createElementBlock("div",Ze,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.pages,(h,y)=>(e.openBlock(),e.createElementBlock("div",{key:y+a.zoomScale,class:"flex w-full flex-col items-center overflow-hidden p-5",onMousedown:f=>a.selectPage(y),onTouchstart:f=>a.selectPage(y),"data-cy":"page-"+y},[e.createElementVNode("div",{class:e.normalizeClass(["relative shadow-lg",{"shadow-outline":y===a.selectedPageIndex}])},[e.createVNode(u,{onMeasure:f=>a.onMeasure(f,y),page:h,zoomScale:a.zoomScale,onFinishedRendering:()=>a.renderFinished(y)},null,8,["onMeasure","page","zoomScale","onFinishedRendering"]),e.createElementVNode("div",{class:"absolute left-0 top-0 origin-top-left transform",style:e.normalizeStyle({transform:`scale(${a.pagesScale[y].scale})`,touchAction:"none"})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.allObjects[y],f=>{var m;return e.openBlock(),e.createElementBlock("div",{key:f.id},[f.type==="drawing"?(e.openBlock(),e.createBlock(M,{key:0,onUpdate:v=>a.updateObject(f.id,v),onDelete:()=>a.deleteObject(f.id),path:f.path,x:f.x,y:f.y,width:f.width,height:f.height,originWidth:f.originWidth,originHeight:f.originHeight,pageScale:(m=a.pagesScale[y])==null?void 0:m.scale,"data-cy":"sign-pos-"+f.id,zoomScale:a.zoomScale},null,8,["onUpdate","onDelete","path","x","y","width","height","originWidth","originHeight","pageScale","data-cy","zoomScale"])):e.createCommentVNode("",!0)])}),128))],4)],2)],40,Ue))),128))])):(e.openBlock(),e.createElementBlock("div",Ge,[e.createElementVNode("span",Je,e.toDisplayString(a.getTranslation.pdfLoading),1)]))])])],64)}const j=A(_e,[["render",Ke],["__scopeId","data-v-477f5e9a"]]);J();const Qe=t=>{t.component(j.name||"DrawSignPdf",j)};j.install=Qe,P.DrawSignPdf=j,P.default=j,Object.defineProperties(P,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
